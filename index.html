<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Yes / No Button Toy — Bluey Dance Mode</title>
<style>
  :root{
    --yes:#2bb673;          /* green */
    --no:#c83939;           /* red   */
    --ring: rgba(0,0,0,.18);
    --bg1:#dff1ff; --bg2:#bfe3ff;
  }
  html,body{
    height:100%;
    margin:0;
    font-family: system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial;
    background: radial-gradient(90vw 90vh at 50% -10%, var(--bg1), var(--bg2));
    display:grid;
    place-items:center;
  }

  .wrap{
    width:min(88vw, 420px);
    aspect-ratio: 598 / 1536;           
    position:relative;
    user-select:none;
    touch-action:manipulation;
  }
  .toy-img{
    position:absolute; inset:0;
    width:100%; height:100%;
    object-fit:contain;
    filter: drop-shadow(0 10px 18px rgba(0,0,0,.12));
    transition: transform 0.3s ease;
  }

  /* Dance mode bounce — runs continuously; removed on audio end */
  @keyframes danceBounce {
    0%,100% { transform: translateY(0) rotate(0deg) scale(1); }
    20% { transform: translateY(-15px) rotate(-5deg) scale(1.05); }
    40% { transform: translateY(10px) rotate(5deg) scale(0.95); }
    60% { transform: translateY(-12px) rotate(-3deg) scale(1.03); }
    80% { transform: translateY(8px) rotate(3deg) scale(0.97); }
  }
  .dance { animation: danceBounce 1s ease-in-out infinite; }

  .hotspot{
    position:absolute;
    aspect-ratio:1/1;
    width:40%;                 
    left:50%; transform:translate(-50%,0);
    border-radius:50%;
    display:grid; place-items:center;
    outline:none; border:none; background:transparent;
    cursor:pointer;
  }
  .hotspot::after{
    content:"";
    position:absolute; inset:0;
    border-radius:50%;
    box-shadow: 0 6px 10px var(--ring) inset, 0 3px 10px rgba(0,0,0,.08);
    opacity:0; transition:opacity .15s ease, transform .08s ease;
  }
  .hotspot:active::after, .hotspot.pressed::after{
    opacity:1; transform:scale(.96);
  }
  .hotspot.yes{ top:9%; }
  .hotspot.no { top:30%; }

  .hotspot:focus-visible{
    box-shadow:0 0 0 6px rgba(255,255,255,.9), 0 0 0 10px rgba(0,0,0,.3);
  }

  .bubble{
    position:fixed; left:50%; bottom:8vh; transform:translateX(-50%) translateY(20px);
    padding:.65rem 1rem; border-radius:999px;
    background:#fff; box-shadow:0 12px 30px rgba(0,0,0,.18);
    font-weight:800; letter-spacing:.5px;
    opacity:0; pointer-events:none;
    transition:opacity .18s ease, transform .18s ease;
    will-change:transform,opacity;
  }
  .bubble.show{ opacity:1; transform:translateX(-50%) translateY(0); }
  .bubble.yes{ color:var(--yes); }
  .bubble.no { color:var(--no);  }

  @keyframes bounce { 
    0%{transform:translate(-50%,0) scale(1)}
    40%{transform:translate(-50%,3px) scale(.96)}
    100%{transform:translate(-50%,0) scale(1)}
  }
  .hotspot.play { animation:bounce .22s ease; }
  @keyframes waggle {
    0%{transform:translate(-50%,0) rotate(0)}
    30%{transform:translate(-50%,0) rotate(-6deg)}
    60%{transform:translate(-50%,0) rotate(6deg)}
    100%{transform:translate(-50%,0) rotate(0)}
  }
  .hotspot.no.play { animation:waggle .25s ease; }
</style>
</head>
<body>

  <main class="wrap" role="application" aria-label="Yes / No Button Toy">
    <!-- Main toy image -->
    <img class="toy-img" src="toy.jpg" alt="Handheld Yes/No toy with a green Y button and red N button." />

    <!-- Hotspots -->
    <button class="hotspot yes" aria-label="Yes" data-kind="yes"></button>
    <button class="hotspot no"  aria-label="No"  data-kind="no"></button>

    <!-- Voice clips -->
    <audio id="voice-yes" preload="auto" playsinline>
      <source src="yes.mp3" type="audio/mpeg" />
      <source src="yes.ogg" type="audio/ogg" />
    </audio>
    <audio id="voice-no" preload="auto" playsinline>
      <source src="no.mp3" type="audio/mpeg" />
      <source src="no.ogg" type="audio/ogg" />
    </audio>
    <audio id="voice-dance" preload="auto" playsinline>
      <source src="dancemode.mp3" type="audio/mpeg" />
    </audio>
  </main>

  <div class="bubble" id="bubble" aria-live="polite"></div>

<script>
(function(){
  const bubble = document.getElementById('bubble');
  const yesBtn = document.querySelector('.hotspot.yes');
  const noBtn  = document.querySelector('.hotspot.no');
  const toyImg = document.querySelector('.toy-img');
  const aYes   = document.getElementById('voice-yes');
  const aNo    = document.getElementById('voice-no');
  const aDance = document.getElementById('voice-dance');

  let yesCount = 0;        // track consecutive YES presses
  let resetTimer;
  let danceActive = false; // prevent retrigger while song plays
  let audioPrimed = false;
  let firstYesPlayed = false;
  let firstNoPlayed = false;

  function vibe(ms=40){ try{ navigator.vibrate && navigator.vibrate(ms);}catch(_){} }

  // One-time audio priming on first user gesture (unlocks playback on iOS/strict browsers)
  function primeAudioOnce(){
    if (audioPrimed) return;
    audioPrimed = true;
    [aYes, aNo, aDance].forEach(el => {
      try{
        el.muted = true;
        el.play().then(() => {
          el.pause();
          el.currentTime = 0;
          el.muted = false;
        }).catch(() => { el.muted = false; });
      }catch(_){ el.muted = false; }
    });
  }
  const primeHandler = () => { primeAudioOnce(); };
  document.addEventListener('pointerdown', primeHandler, { once:true });
  window.addEventListener('keydown', primeHandler, { once:true });

  // Play helper: original element for the first Yes/No; clones afterwards for overlap
  function playClip(el, kind){
    try{
      if (el === aDance){
        el.currentTime = 0;
        el.play().catch(()=>{});
        return;
      }
      if (kind === 'yes' && !firstYesPlayed){
        firstYesPlayed = true;
        el.currentTime = 0;
        el.play().catch(()=>{});
        return;
      }
      if (kind === 'no' && !firstNoPlayed){
        firstNoPlayed = true;
        el.currentTime = 0;
        el.play().catch(()=>{});
        return;
      }
      const clone = el.cloneNode(true);
      clone.play().catch(()=>{});
    }catch(_){}
  }

  function speak(kind, persist=false){
    if(kind === 'dance') {
      bubble.textContent = 'DANCE MODE!';
      bubble.className = 'bubble show yes';
      if(!persist){
        clearTimeout(speak.t); speak.t = setTimeout(()=> bubble.classList.remove('show'), 1000);
      }
      return;
    }
    bubble.textContent = (kind === 'yes') ? 'YES!' : 'NO!';
    bubble.className = `bubble show ${kind}`;
    clearTimeout(speak.t); speak.t = setTimeout(()=> bubble.classList.remove('show'), 800);
  }

  function press(kind){
    if(kind !== 'dance'){
      const btn = (kind==='yes') ? yesBtn : noBtn;
      btn.classList.add('pressed','play');
      setTimeout(()=>btn.classList.remove('pressed','play'), 180);
    }

    if(kind==='yes') playClip(aYes, 'yes');
    else if(kind==='no') playClip(aNo, 'no');
    else if(kind==='dance') playClip(aDance, 'dance');

    vibe(kind==='yes' ? 30 : kind==='no' ? 60 : 120);
    speak(kind, kind==='dance');

    // Dance logic: 3 Yes in a row within 2s windows
    if(kind === 'yes' && !danceActive){
      yesCount++;
      clearTimeout(resetTimer);
      resetTimer = setTimeout(()=> yesCount=0, 2000);

      if(yesCount === 3){
        triggerDanceMode();
        yesCount = 0;
      }
    } else if (kind === 'no'){
      yesCount = 0;
    }
  }

  function triggerDanceMode(){
    if(danceActive) return;
    danceActive = true;

    // Start song + continuous animation
    toyImg.classList.add('dance');
    speak('dance', true);
    playClip(aDance, 'dance');

    // Stop dancing when song ends (or safely when paused at end)
    const endDance = ()=>{
      toyImg.classList.remove('dance');
      bubble.classList.remove('show');
      danceActive = false;
      aDance.removeEventListener('ended', endDance);
      aDance.removeEventListener('pause', maybeEnd);
    };
    const maybeEnd = ()=>{
      if(aDance.currentTime >= (aDance.duration || 0) - 0.05){
        endDance();
      }
    };

    aDance.addEventListener('ended', endDance);
    aDance.addEventListener('pause', maybeEnd);
  }

  // Pointer & keyboard
  document.addEventListener('pointerdown', (e)=>{
    const el = e.target.closest('.hotspot');
    if(!el) return;
    e.preventDefault();
    const kind = el.dataset.kind;
    if(kind === 'yes' || kind === 'no'){
      press(kind);
    }
  });

  window.addEventListener('keydown', (e)=>{
    if(e.repeat) return;
    const k = e.key.toLowerCase();
    if(k==='y'){ press('yes'); }
    if(k==='n'){ press('no'); }
  });

  // Size guard
  const wrap = document.querySelector('.wrap');
  const setSize = ()=> { wrap.style.width = Math.min(window.innerWidth*0.88, 420) + 'px'; };
  window.addEventListener('resize', setSize); setSize();
})();
</script>
</body>
</html>
